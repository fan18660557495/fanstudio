aW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJwppbXBvcnQgcHJpc21hIGZyb20gJ0AvbGliL3ByaXNtYScKaW1wb3J0IHsgcmVxdWlyZUFkbWluIH0gZnJvbSAnQC9saWIvcmVxdWlyZS1hZG1pbicKCmV4cG9ydCBjb25zdCBkeW5hbWljID0gJ2ZvcmNlLWR5bmFtaWMnCgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7CiAgdHJ5IHsKICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHJlcXVlc3QubmV4dFVybC5zZWFyY2hQYXJhbXMKICAgIGNvbnN0IHEgPSBzZWFyY2hQYXJhbXMuZ2V0KCdxJykKICAgIAogICAgY29uc3Qgd2hlcmUgPSBxID8gewogICAgICBPUjogWwogICAgICAgIHsgdGl0bGU6IHsgY29udGFpbnM6IHEgfSB9LAogICAgICAgIHsgZXhjZXJwdDogeyBjb250YWluczogcSB9IH0sCiAgICAgIF0sCiAgICB9IDoge30KICAgIAogICAgY29uc3QgYXJ0aWNsZXMgPSBhd2FpdCBwcmlzbWEua25vd2xlZGdlYmFzZWFydGljbGUuZmluZE1hbnkoewogICAgICB3aGVyZSwKICAgICAgb3JkZXJCeTogeyBzb3J0T3JkZXI6ICdhc2MnIH0sCiAgICAgIGluY2x1ZGU6IHsKICAgICAgICBjYXRlZ29yeTogdHJ1ZSwKICAgICAgICB0YWc6IHRydWUsCiAgICAgICAgdXNlcjogewogICAgICAgICAgc2VsZWN0OiB7CiAgICAgICAgICAgIGlkOiB0cnVlLAogICAgICAgICAgICBuYW1lOiB0cnVlLAogICAgICAgICAgICBhdmF0YXI6IHRydWUsCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIH0sCiAgICB9KQogICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGFydGljbGVzKQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKCfmoLzlvZLnlKjmiLfnlKjmiLfku7vovIEnLCBlcnJvcikKICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAn5qC85b2S55So5oi355So5oi35Lu76LyBJyB9LCB7IHN0YXR1czogNTAwIH0pCiAgfQp9CgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkgewogIGNvbnN0IGNoZWNrID0gYXdhaXQgcmVxdWlyZUFkbWluKCkKICBpZiAoIWRoZWNrLmF1dGhvcml6ZWQpIHJldHVybiBjaGVjay5yZXNwb25zZQoKICB0cnkgewogICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpCiAgICBjb25zdCB7IHRpdGxlLCBzbHVnLCBjb250ZW50LCBleGNlcnB0LCBjb3ZlckltYWdlLCBjb3ZlclJhdGlvLCBzdGF0dXMsIGNhdGVnb3J5SWQsIHRhZ0lkcywgYXV0aG9ySWQsIHNvcnRPcmRlciwgcHVibGlzaGVkQXQgfSA9IGJvZHkKCiAgICBpZiAoIXRpdGxlIHx8ICFzbHVnIHx8ICFjb250ZW50IHx8ICFhdXRob3JJZCkgewogICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ+aYr+a3u+WKoOeul+azlecIH0sIHsgc3RhdHVzOiA0MDAgfSkKICAgIH0KCiAgICBjb25zdCBhcnRpY2xlID0gYXdhaXQgcHJpc21hLmtub3dsZWRnZWJhc2VhcnRpY2xlLmNyZWF0ZSh7CiAgICAgIGRhdGE6IHsKICAgICAgICB0aXRsZSwKICAgICAgICBzbHVnLAogICAgICAgIGNvbnRlbnQsCiAgICAgICAgZXhjZXJwdCwKICAgICAgICBjb3ZlckltYWdlLAogICAgICAgIGNvdmVyUmF0aW8sCiAgICAgICAgc3RhdHVzLAogICAgICAgIGNhdGVnb3J5SWQsCiAgICAgICAgYXV0aG9ySWQsCiAgICAgICAgc29ydE9yZGVyLAogICAgICAgIHB1Ymxpc2hlZEF0OiBwdWJsaXNoZWRBdCA/IG5ldyBEYXRlKHB1Ymxpc2hlZEF0KSA6IG51bGwsCiAgICAgICAgdGFnOiB0YWdJZHMgPyB7IGNvbm5lY3Q6IHRhZ0lkcy5tYXAoKGlkOiBzdHJpbmcpID0+ICh7IGlkIH0pKSB9IDogdW5kZWZpbmVkLAogICAgICB9LAogICAgICBpbmNsdWRlOiB7CiAgICAgICAgY2F0ZWdvcnk6IHRydWUsCiAgICAgICAgdGFnOiB0cnVlLAogICAgICAgIHVzZXI6IHsKICAgICAgICAgIHNlbGVjdDogewogICAgICAgICAgICBpZDogdHJ1ZSwKICAgICAgICAgICAgbmFtZTogdHJ1ZSwKICAgICAgICAgICAgYXZhdGFyOiB0cnVlLAogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICB9LAogICAgfSkKCiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oYXJ0aWNsZSwgeyBzdGF0dXM6IDIwMSB9KQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKCfliKDnva7nlKjmiLfnlKjmiLfllYYnLCBlcnJvcikKICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAn5Yig572u55So5oi355So5oi35ZWGJyB9LCB7IHN0YXR1czogNTAwIH0pCiAgfQp9