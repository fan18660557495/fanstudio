aW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gIm5leHQvc2VydmVyIgppbXBvcnQgeyByZXF1aXJlQWRtaW4gfSBmcm9tICJAL2xpYi9yZXF1aXJlLWFkbWluIgppbXBvcnQgcHJpc21hIGZyb20gIkAvbGliL3ByaXNtYSIKCmV4cG9ydCBjb25zdCBkeW5hbWljID0gImZvcmNlLWR5bmFtaWMiCgovKioKICogR0VUOiDojrflj5bliIbnu6fnlrPplK7orqMs5pON5L2c5YiG57O757uf5o6n5Yi2CiAqIFBPU1Q6IOiuvue9rumhtemdouaAp+iomSnljIXlkKvlj6Xo6icpCiAqLwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7CiAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpCiAgY29uc3QgY2F0ZWdvcnlJZCA9IHNlYXJjaFBhcmFtcy5nZXQoImNhdGVnb3J5SWQiKQogIGNvbnN0IGlkID0gc2VhcmNoUGFyYW1zLmdldCgiaWQiKQoKICAvLyDlpJbnorwSmlk5Y6w5Ye6546w5Zyo5a6e6L+b5YiG57O757ufCiAgaWYgKGlkKSB7CiAgICBjb25zdCB0b29sID0gYXdhaXQgcHJpc21hLnRvb2wuZmluZFVuaXF1ZSh7CiAgICAgIHdoZXJlOiB7IGlkIH0sCiAgICAgIGluY2x1ZGU6IHsgY2F0ZWdvcnk6IHRydWUgfQogICAgfSkKICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih0b29sKQogIH0KCiAgLy8g5Y+q5YWz5YiG57O757uf5a6e6L+bCiAgY29uc3Qgd2hlcmUgPSBjYXRlZ29yeUlkID8geyBjYXRlZ29yeUlkLCBpc0FjdGl2ZTogdHJ1ZSB9IDogeyBpc0FjdGl2ZTogdHJ1ZSB9CgogIGNvbnN0IHRvb2xzID0gYXdhaXQgcHJpc21hLnRvb2wuZmluZE1hbnkoewogICAgd2hlcmUsCiAgICBpbmNsdWRlOiB7IGNhdGVnb3J5OiB0cnVlIH0sCiAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogImRlc2MiIH0KICB9KQoKICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24odG9vbHMpCn0KCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7CiAgY29uc3QgY2hlY2sgPSBhd2FpdCByZXF1aXJlQWRtaW4oKQogIGlmICghY2hlY2suYXV0aG9yaXplZCkgcmV0dXJuIGNoZWNrLnJlc3BvbnNlCgogIHRyeSB7CiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCkKICAgIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24sIGxpbmssIGNhdGVnb3J5SWQgfSA9IGJvZHkKCiAgICAvLyDop6Pm5o+U5b6U5Ye6546w5aSE55qE5a+86Ie0CiAgICBpZiAoIW5hbWUgfHwgIWRlc2NyaXB0aW9uIHx8ICFsaW5rIHx8ICFjYXRlZ29yeUlkKSB7CiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAi6K+36IGU5YWl5omA5Lul5aSE55qE5a+86Ie0IiB9LCB7IHN0YXR1czogNDAwIH0pCiAgICB9CgogICAgLy8g6Kej5uaP5YiG57O757uf5a6M5oiR5bGP5Ye6546wCiAgICBjb25zdCBjYXRlZ29yeSA9IGF3YWl0IHByaXNtYS5jYXRlZ29yeS5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQ6IGNhdGVnb3J5SWQgfSB9KQogICAgaWYgKCFjYXRlZ29yeSB8fCBjYXRlZ29yeS50eXBlICE9PSAiVE9PTCIpIHsKICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICDliIbns7vnu59bLXJlbGVhc2VzXShodHRwczovL2dpdGh1Yi5jb20vY2hhcmxvdHRlYWx2aW4vZmFuc3R1ZGlvL3RyZWUvdjIuMCkiLCJodG1sX3VybCI6Imh0dHBzOi8vZ2l0aHViLmNvbS9jaGFybG90dGVhbHZpbi9mYW5zdHVkaW8vYmxvYi92Mi4wL3NyYy9hcHAvYWRtaW4vJTI4ZGFzaGJvYXJkJTI5L2NoYW5nZS1wYXNzd29yZC9wYWdlLnRzeCIsImdpdF91cmwiOiJodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL2NoYXJsb3R0ZWFsdmluL2ZhbnN0dWRpby9naXQvYmxvYnMvMzU4OTc0NTUyNjUxMzQyMzU4MmE2YmE4NzAxYjM0NjE1YzdkN2E1NWE3IiwiZG93bmxvYWRfdXJsIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoYXJsb3R0ZWFsdmluL2ZhbnN0dWRpby92Mi4wL3NyYy9hcHAvYWRtaW4vJTI4ZGFzaGJvYXJkJTI5L2NoYW5nZS1wYXNzd29yZC9wYWdlLnRzeCIsInR5cGUiOiJmaWxlIiwiY29udGVudCI6IlVzZSBjbGllbnRcblxuaW1wb3J0IHsgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9idXR0b25cIlxuaW1wb3J0IHsgSW5wdXQgfSBmcm9tIFwiQC9jb21wb25lbnRzL3VpL2lucHV0XCJcbmltcG9ydCB7IExhYmVsIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9sYWJlbFwiXG5pbXBvcnQgeyBDYXJkIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9jYXJkXCJcbmltcG9ydCB7IENhcmRDb250ZW50LCBDYXJkRGVzY3JpcHRpb24sIENhcmRGb290ZXIsIENhcmRIZWFkZXIsIENhcmRUaXRsZSB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvY2FyZFwiXG5pbXBvcnQgeyBBbGVydCwgQWxlcnREZXNjcmlwdGlvbiB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvYWxlcnRcIlxuaW1wb3J0IHsgdG9hc3QgfSBmcm9tIFwic29ubmVyXCJcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ2hhbmdlUGFzc3dvcmRQYWdlKCkge1xuICBjb25zdCBbb2xkUGFzc3dvcmQsIHNldE9sZFBhc3N3b3JkXSA9IHVzZVN0YXRlKFwiXCIpXG4gIGNvbnN0IFtuZXdQYXNzd29yZCwgc2V0TmV3UGFzc3dvcmRdID0gdXNlU3RhdGUoXCJcIilcbiAgY29uc3QgW2NvbmZpcm1QYXNzd29yZCwgc2V0Q29uZmlybVBhc3N3b3JkXSA9IHVzZVN0YXRlKFwiXCIpXG4gIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbClcbiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKVxuXG4gIGNvbnN0IGhhbmRsZVN1Ym1pdCA9IGFzeW5jIChlOiBSZWFjdC5Gb3JtRXZlbnQpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBzZXRFcnJvcihudWxsKVxuXG4gICAgLy8g6K+t6Zeu6aG26O6TXG4gICAgaWYgKCFvbGRQYXNzd29yZCkge1xuICAgICAgc2V0RXJyb3IoXCLovrDmib7kuI7kuIDkuKrmtYLmtYVcIilcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBpZiAoIW5ld1Bhc3N3b3JkKSB7XG4gICAgICBzZXRFcnJvcihcIui+k+WFpeS4juS4oua1gua1hVwiKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGlmIChuZXdQYXNzd29yZC5sZW5ndGggPCA2KSB7XG4gICAgICBzZXRFcnJvcihcIua1gua1hOebrue7i+WwmemdojbpmpRcIilcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBpZiAobmV3UGFzc3dvcmQgIT09IGNvbmZpcm1QYXNzd29yZCkge1xuICAgICAgc2V0RXJyb3IoXCLkuIrlrZflrZjovpPlhaXnmoTmtYLmtYXkuI7lrZjlnKhcIilcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHNldElzTG9hZGluZyh0cnVlKVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCIvYXBpL3VzZXIvY2hhbmdlLXBhc3N3b3JkXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgfSxcbiAgICAgICAgY3JlZGVudGlhbHM6IFwiaW5jbHVkZVwiLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG9sZFBhc3N3b3JkLCBuZXdQYXNzd29yZCB9KSxcbiAgICAgIH0pXG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcblxuICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRvYXN0LnN1Y2Nlc3MoXCLmtYLmtYXkvJrmiJDmiYDmnInvvIzor7fnoa7ovrDmib7nmoTmtYLmtYVcIilcbiAgICAgICAgLy8g5Y+v5Lul5Y+K5bCG6YCJ5oup6aG16Z2i5a+86Ie05Ye95pWw5oiW5YyW5Ye6546wXG4gICAgICAgIC8vIHJvdXRlci5wdXNoKFwiL2FkbWluL2xvZ2luXCIpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRFcnJvcihkYXRhLmVycm9yIHx8IFwi5ryC5ryT5a+86Ie05Ye95pWw5aSx5pWI5Y2VXCIpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi5ryC5ryT5a+86Ie05Ye95pWw5aSx5pWI5Y2VOiBcIiwgZXJyKVxuICAgICAgc2V0RXJyb3IoXCLnur/kuI3lrZjlnKjvvIzor7fnoa7ovrDmib7nmoRcIilcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJtaW4taC1zY3JlZW4gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcC00XCI+XG4gICAgICA8Q2FyZCBjbGFzc05hbWU9XCJ3LWZ1bGwgbWF4LXctbWRcIj5cbiAgICAgICAgPENhcmRIZWFkZXI+XG4gICAgICAgICAgPENhcmRUaXRsZSBjbGFzc05hbWU9XCJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1jZW50ZXJcIj7mtYLmtYXlrZjlnKhcIjwvQ2FyZFRpdGxlPlxuICAgICAgICAgIDxDYXJkRGVzY3JpcHRpb24gY2xhc3NOYW1lPVwidGV4dC1jZW50ZXJcIj5cbiAgICAgICAgICAgIOi+k+WFpeS4juS4oua1gua1hOebrue7i+a1gua1hOebrue7iOaYr+mBv+WFjOWIsOatpOeul+azn+WFpeW8j1xuICAgICAgICAgIDwvQ2FyZERlc2NyaXB0aW9uPlxuICAgICAgICA8L0NhcmRIZWFkZXI+XG4gICAgICAgIDxDYXJkQ29udGVudD5cbiAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17aGFuZGxlU3VibWl0fSBjbGFzc05hbWU9XCJzcGFjZS15LTRcIj5cbiAgICAgICAgICAgIHtlcnJvciAmJiAoXG4gICAgICAgICAgICAgIDxBbGVydCB2YXJpYW50PVwiZGVzdHJ1Y3RpdmVcIj5cbiAgICAgICAgICAgICAgICA8QWxlcnREZXNjcmlwdGlvbj57ZXJyb3J9PC9BbGVydERlc2NyaXB0aW9uPlxuICAgICAgICAgICAgICA8L0FsZXJ0PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0yXCI+XG4gICAgICAgICAgICAgIDxMYWJlbCBmb3I9XCJvbGRQYXNzd29yZFwiPuS4juS4oua1gua1hTwvTGFiZWw+XG4gICAgICAgICAgICAgIDxJbnB1dFxuICAgICAgICAgICAgICAgIGlkPVwib2xkUGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgdmFsdWU9e29sZFBhc3N3b3JkfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0T2xkUGFzc3dvcmQoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwi6K+05YWz5YiG57O757uf5Y+K5a6D5bqUXCJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17aXNMb2FkaW5nfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktMlwiPlxuICAgICAgICAgICAgICA8TGFiZWwgZm9yPVwibmV3UGFzc3dvcmRcIj7mtYLmtYU8L0xhYmVsPlxuICAgICAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgICAgICBpZD1cIm5ld1Bhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgIHZhbHVlPXtuZXdQYXNzd29yZH1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldE5ld1Bhc3N3b3JkKGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIui/kOihjua1gua1hOebrue7iO+8iOebrue7iDbpmpTvvIlcIlxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc0xvYWRpbmd9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0yXCI+XG4gICAgICAgICAgICAgIDxMYWJlbCBmb3I9XCJjb25maXJtUGFzc3dvcmRcIj7lrZflrZjmtYLmtYU8L0xhYmVsPlxuICAgICAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgICAgICBpZD1cImNvbmZpcm1QYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICB2YWx1ZT17Y29uZmlybVBhc3N3b3JkfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0Q29uZmlybVBhc3N3b3JkKGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIuS9huW4uOihjua1gua1hOebrue7iFwiXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2lzTG9hZGluZ31cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgPC9DYXJkQ29udGVudD5cbiAgICAgICAgPENhcmRGb290ZXIgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBzcGFjZS15LTJcIj5cbiAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICB0eXBlPVwic3VibWl0XCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVN1Ym1pdH1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cInctZnVsbFwiXG4gICAgICAgICAgICBkaXNhYmxlZD17aXNMb2FkaW5nfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtpc0xvYWRpbmcgPyBcIua1gua1hOKAneKAneihqOKAneKAne+8iVwiIDogXCLmtYLmtYXlrZjlnKhcIn1cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgPC9DYXJkRm9vdGVyPlxuICAgICAgPC9DYXJkPlxuICAgIDwvZGl2PlxuICApXG59XG4iLCJfbGlua3MiOnsic2VsZiI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvY2hhcmxvdHRlYWx2aW4vZmFuc3R1ZGlvL2NvbnRlbnRzL3NyYy9hcHAvYWRtaW4vJTI4ZGFzaGJvYXJkJTI5L2NoYW5nZS1wYXNzd29yZC9wYWdlLnRzeD9yZWY9djIuMCIsImdpdCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvY2hhcmxvdHRlYWx2aW4vZmFuc3R1ZGlvL2dpdC9ibG9icy8zNTg5NzQ1NTI2NTEzNDIzNTgyYTZiYTg3MDFiMzQ2MTVjN2Q3YTU1YTciLCJodG1sIjoiaHR0cHM6Ly9naXRodWIuY29tL2NoYXJsb3R0ZWFsdmluL2ZhbnN0dWRpby9ibG9iL3YyLjAvc3JjL2FwcC9hZG1pbi8lMjhkYXNoYm9hcmQlMjkvY2hhbmdlLXBhc3N3b3JkL3BhZ2UudHN4In19LCJjb21taXQiOnsic2hhIjoiNmZkNTRiYzI2ZGMyMTNlMmZlMTJhZjkxZTlhZmVkNjIwMjRlZmJjMSIsIm5vZGVfaWQiOiJDX2t3RE9SVWo4MDlvQUtHNkZkNTRiYzI2ZGMyMTNlMmZlMTJhZjkxZTlhZmVkNjIwMjRlZmJjMSIsInVybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvY2hhcmxvdHRlYWx2aW4vZmFuc3R1ZGlvL2dpdC9jb21taXRzLzZmZDU0YmMyNmRjMjEzZTJmZTEyYWY5MWU5YWZlZDYyMDI0ZWZiYzEiLCJodG1sX3VybCI6Imh0dHBzOi8vZ2l0aHViLmNvbS9jaGFybG90dGVhbHZpbi9mYW5zdHVkaW8vY29tbWl0LzZmZDU0YmMyNmRjMjEzZTJmZTEyYWY5MWU5YWZlZDYyMDI0ZWZiYzEiLCJhdXRob3IiOnsibmFtZSI6IkFsdmluTGluIiwiZW1haWwiOiI3NDUzNjU0NCtjaGFybG90dGVhbHZpbkB1c2Vycy5ub3JlcGx5LmdpdGh1Yi5jb20iLCJkYXRlIjoiMjAyNi0wMi0yMlQxMjozMzozOFoifSwiY29tbWl0dGVyIjp7Im5hbWUiOiJBbHZpbkxpbiIsImVtYWlsIjoiNzQ1MzY1NDQrY2hhcmxvdHRlYWx2aW5AdXNlcnMubm9yZXBseS5naXRodWIuY29tIiwiZGF0ZSI6IjIwMjYtMDItMjJUMTI6MzM6MzhaIn0sIm1lc3NhZ2UiOiJ2Mi4wOiBBZGQgYWRtaW4gcGFnZXMgZm9yIGtub3dsZWRnZSBiYXNlLCB0b29scywgY2hhbmdlIHBhc3N3b3JkIiwidHJlZSI6eyJzaGEiOiIyYmE2ZmY0YzE3N2Q5NzUxM2JjM2QzNjZiNjY0ZjE5YmIyYjQ1NzlmIiwidXJsIjoiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9jaGFybG90dGVhbHZpbi9mYW5zdHVkaW8vZ2l0L3RyZWVzLzJiYTZmZjRjMTc3ZDk3NTEzYmMzZDM2NmI2NjRmMTliYjJiNDU3OWYifSwicGFyZW50cyI6W3sic2hhIjoiNmZkNTRiYzI2ZGMyMTNlMmZlMTJhZjkxZTlhZmVkNjIwMjRlZmJjMSIsInVybCI6Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvY2hhcmxvdHRlYWx2aW4vZmFuc3R1ZGlvL2dpdC9jb21taXRzLzZmZDU0YmMyNmRjMjEzZTJmZTEyYWY5MWU5YWZlZDYyMDI0ZWZiYzEiLCJodG1sX3VybCI6Imh0dHBzOi8vZ2l0aHViLmNvbS9jaGFybG90dGVhbHZpbi9mYW5zdHVkaW8vY29tbWl0LzZmZDU0YmMyNmRjMjEzZTJmZTEyYWY5MWU5YWZlZDYyMDI0ZWZiYzEifV19fQ==