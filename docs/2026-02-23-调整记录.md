# 2026-02-23 调整记录

## 1. 前台浏览器标签图标支持后台上传（PNG）
- 目标：
  - 后台可配置 favicon，减少手工维护 `ico` 的成本。
  - 上传入口放在“网站设置 -> 基本设置”。
- 实施内容：
  - 在设置页新增“浏览器图标（Favicon）”上传/更换/移除控件。
  - 上传仅允许 `PNG`，前端自动压缩后保存。
  - 配置项写入 `pageCopy.siteFavicon`，随现有设置接口一起持久化。
- 变更文件：
  - `/Users/fan/code/fanstudio/src/app/admin/(dashboard)/settings/page.tsx`
  - `/Users/fan/code/fanstudio/src/lib/page-copy.ts`

## 2. 默认 favicon 兜底策略
- 需求：
  - 用户未上传时，系统必须有默认图标。
- 实施内容：
  - 元数据生成逻辑优先读取 `pageCopy.siteFavicon`。
  - 若未配置，则回退到系统默认图标，不会出现空 favicon。
- 变更文件：
  - `/Users/fan/code/fanstudio/src/app/layout.tsx`

## 3. 默认图标改为圆形
- 需求：
  - 默认图标视觉为圆形。
- 实施内容：
  - 新增 Next App Router 图标生成文件 `app/icon.tsx`，输出圆形 PNG。
  - 默认回退路径由 `favicon.ico` 调整为 `/icon`（支持缓存参数）。
- 变更文件：
  - `/Users/fan/code/fanstudio/src/app/icon.tsx`
  - `/Users/fan/code/fanstudio/src/app/layout.tsx`

## 4. 图片压缩能力扩展
- 背景：
  - 原压缩工具固定输出 JPEG，不适合 favicon 的 PNG 场景。
- 实施内容：
  - `compressImageToDataUrl` 新增可选参数：
    - `maxSize`
    - `mimeType`（支持 `image/png`）
    - `jpegQuality`
  - 保持旧调用兼容（默认行为不变）。
- 变更文件：
  - `/Users/fan/code/fanstudio/src/lib/avatar-compress.ts`

## 5. 校验记录
- 执行命令：
  - `npm run -s lint -- src/app/layout.tsx src/app/admin/(dashboard)/settings/page.tsx src/lib/avatar-compress.ts src/lib/page-copy.ts`
  - `npm run -s lint -- src/app/icon.tsx src/app/layout.tsx`
- 结果：
  - 无 error。
  - `settings/page.tsx` 存在项目既有 `@next/next/no-img-element` warning（非本次新增错误类型）。
